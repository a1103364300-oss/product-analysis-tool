<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å•†å“ç»¼åˆè¯„ä¼°åˆ†æå·¥å…· - æ¯›åˆ©é”€é‡å¤šç»´åº¦åˆ†æ</title>
    <meta name="description" content="ä¸“ä¸šçš„å•†å“é”€å”®åˆ†æå·¥å…·ï¼Œä»æ¯›åˆ©å’Œé”€é‡å¤šç»´åº¦è¯„ä¼°å•†å“ä»·å€¼ï¼ŒåŒ…å«ç»¼åˆè¯„åˆ†ã€ABCåˆ†ç±»ã€èšç±»åˆ†æç­‰å¤šç§æ–¹æ³•">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        /* å¤´éƒ¨ */
        .header {
            text-align: center;
            color: white;
            padding: 40px 20px;
            margin-bottom: 30px;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.3) 0%, rgba(118, 75, 162, 0.3) 100%);
            border-radius: 20px;
            backdrop-filter: blur(10px);
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.6;
        }

        /* ä¸Šä¼ åŒºåŸŸ */
        .upload-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .upload-zone {
            border: 3px dashed #667eea;
            border-radius: 15px;
            padding: 60px 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8eb 100%);
        }

        .upload-zone:hover {
            border-color: #764ba2;
            transform: scale(1.02);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        }

        .upload-zone.dragover {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: white;
        }

        .upload-icon {
            font-size: 60px;
            margin-bottom: 20px;
        }

        .upload-zone h3 {
            color: #333;
            margin-bottom: 10px;
            font-size: 1.5em;
        }

        .upload-zone p {
            color: #666;
            font-size: 0.95em;
        }

        .file-input {
            display: none;
        }

        .btn {
            display: inline-block;
            padding: 15px 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 50px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.5);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: #333;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .btn-secondary:hover {
            box-shadow: 0 15px 40px rgba(0,0,0,0.2);
        }

        /* åˆ†ææ–¹æ³•é€‰æ‹© */
        .method-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .method-section h3 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.3em;
        }

        .method-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .method-card {
            border: 2px solid #eee;
            border-radius: 15px;
            padding: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .method-card:hover {
            border-color: #667eea;
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.2);
        }

        .method-card.active {
            border-color: #667eea;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
        }

        .method-card h4 {
            color: #333;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .method-card p {
            color: #666;
            font-size: 0.9em;
            line-height: 1.6;
        }

        .method-icon {
            font-size: 40px;
            margin-bottom: 15px;
        }

        /* æƒé‡è®¾ç½® */
        .weight-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            display: none;
        }

        .weight-section.show {
            display: block;
        }

        .weight-section h3 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.3em;
        }

        .weight-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
        }

        .weight-control {
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .weight-control label {
            display: block;
            margin-bottom: 10px;
            color: #333;
            font-weight: bold;
        }

        .weight-control input[type="range"] {
            width: 100%;
            margin-bottom: 10px;
        }

        .weight-value {
            text-align: center;
            font-size: 1.5em;
            font-weight: bold;
            color: #667eea;
        }

        /* ç»“æœå±•ç¤º */
        .results-section {
            display: none;
        }

        .results-section.show {
            display: block;
        }

        /* ç»Ÿè®¡æ¦‚è§ˆ */
        .overview-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .overview-section h2 {
            color: #333;
            margin-bottom: 25px;
            font-size: 1.5em;
            border-bottom: 3px solid #667eea;
            padding-bottom: 15px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .stat-item {
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8eb 100%);
            border-radius: 10px;
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-label {
            color: #666;
            margin-top: 5px;
            font-size: 0.9em;
        }

        /* åˆ†æç»“æœåŒºåŸŸ */
        .analysis-result {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .analysis-result h2 {
            color: #333;
            margin-bottom: 25px;
            font-size: 1.5em;
            border-bottom: 3px solid #667eea;
            padding-bottom: 15px;
        }

        /* ç»¼åˆè¯„åˆ†ç»“æœ */
        .score-ranking {
            margin-bottom: 30px;
        }

        .score-item {
            display: grid;
            grid-template-columns: 80px 1fr 100px 120px 100px;
            gap: 15px;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #eee;
            transition: background 0.3s;
        }

        .score-item:hover {
            background: #f5f7fa;
        }

        .rank-badge {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            font-size: 1.2em;
        }

        .rank-1 { background: linear-gradient(135deg, #ffd700, #ffb700); }
        .rank-2 { background: linear-gradient(135deg, #c0c0c0, #a0a0a0); }
        .rank-3 { background: linear-gradient(135deg, #cd7f32, #b8722f); }
        .rank-other { background: linear-gradient(135deg, #667eea, #764ba2); }

        .product-info {
            overflow: hidden;
        }

        .product-name {
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }

        .product-spec {
            font-size: 0.85em;
            color: #666;
        }

        .score-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #667eea;
        }

        .score-breakdown {
            display: flex;
            gap: 10px;
            font-size: 0.85em;
        }

        .breakdown-item {
            padding: 5px 10px;
            border-radius: 5px;
            background: #f0f0f0;
        }

        .grade-badge {
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9em;
        }

        .grade-s { background: linear-gradient(135deg, #ffd700, #ffb700); color: white; }
        .grade-a { background: linear-gradient(135deg, #27ae60, #2ecc71); color: white; }
        .grade-b { background: linear-gradient(135deg, #3498db, #2980b9); color: white; }
        .grade-c { background: linear-gradient(135deg, #f39c12, #e67e22); color: white; }
        .grade-d { background: linear-gradient(135deg, #e74c3c, #c0392b); color: white; }

        /* ABCåˆ†ç±»è¡¨æ ¼ */
        .abc-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .abc-category {
            border-radius: 15px;
            overflow: hidden;
        }

        .abc-header {
            padding: 15px;
            color: white;
            font-weight: bold;
            text-align: center;
        }

        .abc-a .abc-header { background: linear-gradient(135deg, #27ae60, #2ecc71); }
        .abc-b .abc-header { background: linear-gradient(135deg, #f39c12, #e67e22); }
        .abc-c .abc-header { background: linear-gradient(135deg, #e74c3c, #c0392b); }

        .abc-body {
            padding: 15px;
            background: white;
            max-height: 300px;
            overflow-y: auto;
        }

        .abc-product {
            padding: 10px;
            border-bottom: 1px solid #eee;
            font-size: 0.9em;
        }

        .abc-product:last-child {
            border-bottom: none;
        }

        .abc-product-name {
            font-weight: bold;
            color: #333;
            margin-bottom: 3px;
        }

        .abc-product-stats {
            font-size: 0.8em;
            color: #666;
        }

        /* äº¤å‰åˆ†æè¡¨ */
        .cross-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .cross-table th,
        .cross-table td {
            padding: 15px;
            text-align: center;
            border: 2px solid #fff;
        }

        .cross-table th {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            font-weight: bold;
        }

        .cross-table td {
            background: #f8f9fa;
        }

        .cross-category {
            font-weight: bold;
            padding: 10px;
            border-radius: 5px;
            color: white;
        }

        .cross-aa { background: linear-gradient(135deg, #27ae60, #2ecc71); }
        .cross-ab { background: linear-gradient(135deg, #3498db, #2980b9); }
        .cross-ac { background: linear-gradient(135deg, #f39c12, #e67e22); }
        .cross-ba { background: linear-gradient(135deg, #3498db, #2980b9); }
        .cross-bb { background: linear-gradient(135deg, #f39c12, #e67e22); }
        .cross-bc { background: linear-gradient(135deg, #e74c3c, #c0392b); }
        .cross-ca { background: linear-gradient(135deg, #f39c12, #e67e22); }
        .cross-cb { background: linear-gradient(135deg, #e74c3c, #c0392b); }
        .cross-cc { background: linear-gradient(135deg, #c0392b, #a93226); }

        /* å›¾è¡¨å®¹å™¨ */
        .chart-container {
            position: relative;
            height: 500px;
            margin-bottom: 30px;
        }

        .chart-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .chart-box {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .chart-box h4 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.1em;
        }

        /* æ•°æ®è¡¨æ ¼ */
        .data-table-container {
            overflow-x: auto;
            margin-top: 20px;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .data-table th,
        .data-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        .data-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: bold;
            position: sticky;
            top: 0;
        }

        .data-table tr:hover {
            background: #f5f7fa;
        }

        /* æŒ‰é’®ç»„ */
        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        /* åŠ è½½åŠ¨ç”» */
        .loading {
            display: none;
            text-align: center;
            padding: 60px 20px;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* é”™è¯¯æç¤º */
        .error-message {
            display: none;
            background: #fee;
            border: 1px solid #fcc;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            color: #c00;
        }

        .error-message.show {
            display: block;
        }

        /* è¿”å›é¡¶éƒ¨ */
        .back-to-top {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .back-to-top.show {
            opacity: 1;
            visibility: visible;
        }

        .back-to-top:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.5);
        }

        /* å“åº”å¼ */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }

            .abc-grid {
                grid-template-columns: 1fr;
            }

            .chart-row {
                grid-template-columns: 1fr;
            }

            .score-item {
                grid-template-columns: 60px 1fr;
                gap: 10px;
            }

            .score-breakdown, .grade-badge {
                grid-column: 2;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- å¤´éƒ¨ -->
        <header class="header">
            <h1>ğŸ“Š å•†å“ç»¼åˆè¯„ä¼°åˆ†æå·¥å…·</h1>
            <p>åŸºäºæ¯›åˆ©å’Œé”€é‡å¤šç»´åº¦è¯„ä¼°å•†å“ä»·å€¼ï¼Œæä¾›ç»¼åˆè¯„åˆ†ã€ABCåˆ†ç±»ã€èšç±»åˆ†æç­‰å¤šç§ä¸“ä¸šåˆ†ææ–¹æ³•ï¼Œå¸®åŠ©æ‚¨ç§‘å­¦å†³ç­–</p>
        </header>

        <!-- ä¸Šä¼ åŒºåŸŸ -->
        <section class="upload-section">
            <div class="upload-zone" id="uploadZone">
                <div class="upload-icon">ğŸ“</div>
                <h3>æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„æˆ–ç‚¹å‡»é€‰æ‹©æ–‡ä»¶</h3>
                <p>æ”¯æŒ .xlsx, .xls æ ¼å¼çš„Excelæ–‡ä»¶</p>
                <input type="file" id="fileInput" class="file-input" accept=".xlsx,.xls">
                <button class="btn" id="selectFileBtn">é€‰æ‹©æ–‡ä»¶</button>
            </div>

            <div class="error-message" id="errorMessage"></div>

            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>æ­£åœ¨åˆ†ææ•°æ®ï¼Œè¯·ç¨å€™...</p>
            </div>
        </section>

        <!-- åˆ†ææ–¹æ³•é€‰æ‹© -->
        <section class="method-section" id="methodSection" style="display: none;">
            <h3>ğŸ¯ é€‰æ‹©åˆ†ææ–¹æ³•</h3>
            <div class="method-cards">
                <div class="method-card active" data-method="comprehensive">
                    <div class="method-icon">â­</div>
                    <h4>ç»¼åˆè¯„åˆ†æ³•</h4>
                    <p>å¯¹æ¯›åˆ©å’Œé”€é‡è¿›è¡Œæ ‡å‡†åŒ–ï¼Œæ ¹æ®æƒé‡è®¡ç®—ç»¼åˆå¾—åˆ†ï¼Œæ’ååˆ†ç­‰çº§</p>
                </div>
                <div class="method-card" data-method="abc">
                    <div class="method-icon">ğŸ“ˆ</div>
                    <h4>ABCåˆ†ç±»æ³•</h4>
                    <p>åŸºäºå¸•ç´¯æ‰˜æ³•åˆ™ï¼ŒæŒ‰æ¯›åˆ©å’Œé”€é‡åˆ†åˆ«ABCåˆ†ç±»ï¼Œäº¤å‰åˆ†æ9å®«æ ¼</p>
                </div>
                <div class="method-card" data-method="cluster">
                    <div class="method-icon">ğŸ¯</div>
                    <h4>èšç±»åˆ†æ</h4>
                    <p>ä½¿ç”¨K-meansç®—æ³•è‡ªåŠ¨å‘ç°å•†å“è‡ªç„¶åˆ†ç»„ï¼Œæ— éœ€é¢„è®¾åˆ†ç•Œçº¿</p>
                </div>
                <div class="method-card" data-method="all">
                    <div class="method-icon">ğŸ“Š</div>
                    <h4>ç»¼åˆåˆ†æ</h4>
                    <p>åŒæ—¶å±•ç¤ºä»¥ä¸Šæ‰€æœ‰åˆ†ææ–¹æ³•çš„ç»“æœï¼Œå…¨æ–¹ä½è¯„ä¼°å•†å“ä»·å€¼</p>
                </div>
            </div>

            <!-- æƒé‡è®¾ç½® -->
            <div class="weight-section" id="weightSection">
                <h3>âš–ï¸ è®¾ç½®è¯„åˆ†æƒé‡</h3>
                <div class="weight-controls">
                    <div class="weight-control">
                        <label>æ¯›åˆ©æƒé‡ï¼š<span id="profitWeightValue">60</span>%</label>
                        <input type="range" id="profitWeight" min="0" max="100" value="60">
                        <div style="font-size: 0.85em; color: #666;">
                            åæ˜ å•†å“çš„ç›ˆåˆ©èƒ½åŠ›
                        </div>
                    </div>
                    <div class="weight-control">
                        <label>é”€é‡æƒé‡ï¼š<span id="salesWeightValue">40</span>%</label>
                        <input type="range" id="salesWeight" min="0" max="100" value="40">
                        <div style="font-size: 0.85em; color: #666;">
                            åæ˜ å•†å“çš„å¸‚åœºçƒ­åº¦
                        </div>
                    </div>
                </div>
            </div>

            <div class="action-buttons">
                <button class="btn" id="startAnalysisBtn">ğŸš€ å¼€å§‹åˆ†æ</button>
                <button class="btn btn-secondary" id="resetBtn">ğŸ”„ é‡æ–°é€‰æ‹©</button>
            </div>
        </section>

        <!-- åˆ†æç»“æœ -->
        <section class="results-section" id="resultsSection">
            <!-- ç»Ÿè®¡æ¦‚è§ˆ -->
            <section class="overview-section">
                <h2>ğŸ“Š æ•°æ®æ¦‚è§ˆ</h2>
                <div class="stats-grid" id="statsGrid">
                    <!-- åŠ¨æ€ç”Ÿæˆ -->
                </div>
            </section>

            <!-- ç»¼åˆè¯„åˆ†ç»“æœ -->
            <section class="analysis-result" id="scoreSection">
                <h2>â­ ç»¼åˆè¯„åˆ†æ’å</h2>
                <div class="score-ranking" id="scoreRanking">
                    <!-- åŠ¨æ€ç”Ÿæˆ -->
                </div>
            </section>

            <!-- ABCåˆ†ç±»ç»“æœ -->
<section class="analysis-result" id="abcSection">
                <h2>ğŸ“ˆ ABCåˆ†ç±»åˆ†æ</h2>
                <div class="abc-grid" id="abcGrid">
                    <!-- åŠ¨æ€ç”Ÿæˆ -->
                </div>
                <h3 style="margin: 30px 0 20px; font-size: 1.2em;">äº¤å‰åˆ†æçŸ©é˜µ</h3>
                <div id="crossAnalysis">
                    <!-- åŠ¨æ€ç”Ÿæˆ -->
                </div>
            </section>

            <!-- èšç±»åˆ†æç»“æœ -->
            <section class="analysis-result" id="clusterSection">
                <h2>ğŸ¯ èšç±»åˆ†æç»“æœ</h2>
                <div class="chart-row">
                    <div class="chart-box">
                        <h4>èšç±»åˆ†å¸ƒæ•£ç‚¹å›¾</h4>
                        <div class="chart-container" style="height: 350px;">
                            <canvas id="clusterChart"></canvas>
                        </div>
                    </div>
                    <div class="chart-box">
                        <h4>å„ç°‡å•†å“ç»Ÿè®¡</h4>
                        <div id="clusterStats">
                            <!-- åŠ¨æ€ç”Ÿæˆ -->
                        </div>
                    </div>
                </div>
            </section>

            <!-- å¯è§†åŒ–å›¾è¡¨ -->
            <section class="analysis-result">
                <h2>ğŸ“Š å¯è§†åŒ–åˆ†æ</h2>
                <div class="chart-row">
                    <div class="chart-box">
                        <h4>å››è±¡é™åˆ†å¸ƒå›¾</h4>
                        <div class="chart-container" style="height: 350px;">
                            <canvas id="quadrantChart"></canvas>
                        </div>
                    </div>
                    <div class="chart-box">
                        <h4>è¯„åˆ†åˆ†å¸ƒç›´æ–¹å›¾</h4>
                        <div class="chart-container" style="height: 350px;">
                            <canvas id="histogramChart"></canvas>
                        </div>
                    </div>
                </div>
                <div class="chart-box" style="margin-top: 20px;">
                    <h4>å•†å“æ¯›åˆ©-é”€é‡å…³ç³»å›¾</h4>
                    <div class="chart-container" style="height: 400px;">
                        <canvas id="scatterChart"></canvas>
                    </div>
                </div>
                <!-- å¤šç»´åº¦é›·è¾¾å›¾åˆ†æ -->
                <div class="chart-box" style="margin-top: 20px;">
                    <h4>ğŸ¯ å¤šç»´åº¦å•†å“è¯„ä¼°é›·è¾¾å›¾</h4>
                    <p style="color: #666; margin-bottom: 15px; font-size: 0.9em;">
                        é€‰æ‹©å•†å“æŸ¥çœ‹å…¶å¤šç»´åº¦è¯„ä¼°æŒ‡æ ‡ï¼Œæˆ–æŸ¥çœ‹å„ç­‰çº§å•†å“çš„å¹³å‡è¡¨ç°
                    </p>
                    <div style="margin-bottom: 20px;">
                        <label style="margin-right: 10px;">æŸ¥çœ‹æ–¹å¼ï¼š</label>
                        <select id="radarViewMode" style="padding: 8px 15px; border-radius: 5px; border: 1px solid #ddd;">
                            <option value="top10">TOP10 å•†å“å¯¹æ¯”</option>
                            <option value="grade">å„ç­‰çº§å¹³å‡è¡¨ç°</option>
                            <option value="custom">è‡ªå®šä¹‰é€‰æ‹©å•†å“</option>
                        </select>
                        <select id="radarProductSelect" style="padding: 8px 15px; border-radius: 5px; border: 1px solid #ddd; margin-left: 10px; display: none;">
                            <option value="">è¯·é€‰æ‹©å•†å“</option>
                        </select>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div class="chart-container" style="height: 400px;">
                            <canvas id="radarChart"></canvas>
                        </div>
                        <div style="padding: 20px; background: #f8f9fa; border-radius: 10px;">
                            <h5 style="margin-bottom: 15px; color: #333;">ğŸ“‹ è¯„ä¼°æŒ‡æ ‡è¯´æ˜</h5>
                            <div style="margin-bottom: 15px;">
                                <strong style="color: #667eea;">ç›ˆåˆ©èƒ½åŠ›</strong>
                                <p style="font-size: 0.85em; color: #666; margin-top: 5px;">
                                    åŸºäºå•†å“æ¯›åˆ©åœ¨æ‰€æœ‰å•†å“ä¸­çš„æ ‡å‡†åŒ–å¾—åˆ†(0-100)ï¼Œåæ˜ å•†å“çš„åˆ©æ¶¦è´¡çŒ®èƒ½åŠ›
                                </p>
                            </div>
                            <div style="margin-bottom: 15px;">
                                <strong style="color: #27ae60;">é”€å”®çƒ­åº¦</strong>
                                <p style="font-size: 0.85em; color: #666; margin-top: 5px;">
                                    åŸºäºå•†å“é”€é‡åœ¨æ‰€æœ‰å•†å“ä¸­çš„æ ‡å‡†åŒ–å¾—åˆ†(0-100)ï¼Œåæ˜ å•†å“çš„å¸‚åœºå—æ¬¢è¿ç¨‹åº¦
                                </p>
                            </div>
                            <div style="margin-bottom: 15px;">
                                <strong style="color: #f39c12;">ç»¼åˆè¯„åˆ†</strong>
                                <p style="font-size: 0.85em; color: #666; margin-top: 5px;">
                                    æ¯›åˆ©å’Œé”€é‡åŠ æƒè®¡ç®—çš„ç»¼åˆå¾—åˆ†(0-100)ï¼Œåæ˜ å•†å“çš„æ€»ä½“ä»·å€¼è¯„ä¼°
                                </p>
                            </div>
                            <div style="margin-bottom: 15px;">
                                <strong style="color: #e74c3c;">åˆ©æ¶¦å æ¯”</strong>
                                <p style="font-size: 0.85em; color: #666; margin-top: 5px;">
                                    å•å“æ¯›åˆ©å æ€»æ¯›åˆ©çš„ç™¾åˆ†æ¯”ï¼Œåæ˜ å•†å“çš„åˆ©æ¶¦è´¡çŒ®é‡è¦æ€§
                                </p>
                            </div>
                            <div>
                                <strong style="color: #3498db;">ä»·å€¼ç³»æ•°</strong>
                                <p style="font-size: 0.85em; color: #666; margin-top: 5px;">
                                    æ¯›åˆ©/é”€é‡çš„æ¯”å€¼ï¼Œåæ˜ å•ä½é”€é‡äº§ç”Ÿçš„åˆ©æ¶¦ä»·å€¼
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- å®Œæ•´æ•°æ®è¡¨ -->
            <section class="analysis-result">
                <h2>ğŸ“‹ å®Œæ•´åˆ†ææ•°æ®</h2>
                <div class="data-table-container">
                    <table class="data-table" id="fullDataTable">
                        <thead>
                            <tr>
                                <th>æ’å</th>
                                <th>å•†å“åç§°</th>
                                <th>è§„æ ¼</th>
                                <th>é”€é‡</th>
                                <th>æ¯›åˆ©é¢(å…ƒ)</th>
                                <th>ç»¼åˆå¾—åˆ†</th>
                                <th>ç­‰çº§</th>
                                <th>ABCåˆ†ç±»(æ¯›/é”€)</th>
                                <th>èšç±»ç°‡</th>
                            </tr>
                        </thead>
                        <tbody id="fullDataBody">
                            <!-- åŠ¨æ€ç”Ÿæˆ -->
                        </tbody>
                    </table>
                </div>

                <div class="action-buttons">
                    <button class="btn" id="downloadReportBtn">ğŸ“¥ ä¸‹è½½åˆ†ææŠ¥å‘Š</button>
                    <button class="btn btn-secondary" id="newAnalysisBtn">ğŸ”„ é‡æ–°åˆ†æ</button>
                </div>
            </section>
        </section>
    </div>

    <!-- è¿”å›é¡¶éƒ¨æŒ‰é’® -->
    <button class="back-to-top" id="backToTop" title="è¿”å›é¡¶éƒ¨">â†‘</button>

    <!-- å¼•å…¥ç¬¬ä¸‰æ–¹åº“ -->
    <script src="src/libs/xlsx.full.min.js"></script>
    <script src="src/libs/chart.min.js"></script>

    <!-- ä¸»åº”ç”¨é€»è¾‘ -->
    <script>
        // å…¨å±€å˜é‡
        let rawData = null;
        let analysisResults = null;
        let selectedMethod = 'comprehensive';
        let chartInstances = {};

        // DOMå…ƒç´ 
        const uploadZone = document.getElementById('uploadZone');
        const fileInput = document.getElementById('fileInput');
        const selectFileBtn = document.getElementById('selectFileBtn');
        const methodSection = document.getElementById('methodSection');
        const weightSection = document.getElementById('weightSection');
        const resultsSection = document.getElementById('resultsSection');
        const loading = document.getElementById('loading');
        const errorMessage = document.getElementById('errorMessage');

        // åˆå§‹åŒ–
        init();

        function init() {
            // äº‹ä»¶ç›‘å¬
            selectFileBtn.addEventListener('click', () => fileInput.click());
            fileInput.addEventListener('change', handleFileSelect);
            uploadZone.addEventListener('dragover', handleDragOver);
            uploadZone.addEventListener('dragleave', handleDragLeave);
            uploadZone.addEventListener('drop', handleDrop);

            // æ–¹æ³•é€‰æ‹©
            document.querySelectorAll('.method-card').forEach(card => {
                card.addEventListener('click', () => selectMethod(card.dataset.method));
            });

            // æƒé‡æ»‘å—
            document.getElementById('profitWeight').addEventListener('input', updateWeights);
            document.getElementById('salesWeight').addEventListener('input', updateWeights);

            // æŒ‰é’®
            document.getElementById('startAnalysisBtn').addEventListener('click', startAnalysis);
            document.getElementById('resetBtn').addEventListener('click', reset);
            document.getElementById('newAnalysisBtn').addEventListener('click', () => location.reload());
            document.getElementById('downloadReportBtn').addEventListener('click', downloadReport);

            // è¿”å›é¡¶éƒ¨
            window.addEventListener('scroll', handleScroll);
            document.getElementById('backToTop').addEventListener('click', scrollToTop);
        }

        function handleDragOver(e) {
            e.preventDefault();
            uploadZone.classList.add('dragover');
        }

        function handleDragLeave(e) {
            e.preventDefault();
            uploadZone.classList.remove('dragover');
        }

        function handleDrop(e) {
            e.preventDefault();
            uploadZone.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) processFile(files[0]);
        }

        function handleFileSelect(e) {
            const files = e.target.files;
            if (files.length > 0) processFile(files[0]);
        }

        function processFile(file) {
            const validTypes = [
                'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',
                'application/vnd.ms-excel'
            ];

            if (!validTypes.includes(file.type) && !file.name.match(/\.(xlsx|xls)$/i)) {
                showError('è¯·ä¸Šä¼ æœ‰æ•ˆçš„Excelæ–‡ä»¶ï¼ˆ.xlsx æˆ– .xls æ ¼å¼ï¼‰');
                return;
            }

            showLoading(true);
            hideError();

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const sheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[sheetName];
                    const jsonData = XLSX.utils.sheet_to_json(worksheet);

                    if (jsonData.length === 0) throw new Error('Excelæ–‡ä»¶ä¸­æ²¡æœ‰æ•°æ®');

                    rawData = parseData(jsonData);
                    if (rawData.length === 0) throw new Error('æ— æ³•è§£ææ•°æ®ï¼Œè¯·æ£€æŸ¥æ•°æ®æ ¼å¼');

                    showLoading(false);
                    methodSection.style.display = 'block';
                    methodSection.scrollIntoView({ behavior: 'smooth' });

                } catch (error) {
                    showLoading(false);
                    showError(error.message || 'è§£ææ–‡ä»¶æ—¶å‘ç”Ÿé”™è¯¯');
                    console.error('Error:', error);
                }
            };

            reader.onerror = function() {
                showLoading(false);
                showError('è¯»å–æ–‡ä»¶æ—¶å‘ç”Ÿé”™è¯¯');
            };

            reader.readAsArrayBuffer(file);
        }

        function parseData(jsonData) {
            const products = [];

            for (let i = 0; i < jsonData.length; i++) {
                const row = jsonData[i];
                const name = row['å•†å“åç§°'] || row['name'] || row['äº§å“åç§°'] || row['å“å'] || row['å•†å“'] || '';
                const spec = row['è§„æ ¼'] || row['spec'] || row['å‹å·'] || row['è§„æ ¼å‹å·'] || '';
                const sku = row['SKU'] || row['sku'] || row['ç¼–å·'] || row['ç¼–ç '] || '';
                const sales = parseFloat(row['æ€»é”€é‡'] || row['é”€é‡'] || row['é”€å”®æ•°é‡'] || row['é”€é‡(ä»¶)'] || row['é”€å”®é‡'] || '0');
                const profit = parseFloat(row['å•†å“æ¯›åˆ©é¢'] || row['æ¯›åˆ©é¢'] || row['æ¯›åˆ©'] || row['åˆ©æ¶¦'] || row['æ¯›åˆ©é‡‘é¢'] || '0');

                if (!name || isNaN(sales) || isNaN(profit)) continue;

                products.push({
                    id: i + 1,
                    name: String(name).trim(),
                    spec: String(spec || '').trim(),
                    sku: String(sku || '').trim(),
                    sales: sales,
                    profit: profit
                });
            }

            return products;
        }

        function selectMethod(method) {
            selectedMethod = method;
            document.querySelectorAll('.method-card').forEach(card => {
                card.classList.toggle('active', card.dataset.method === method);
            });

            // æ˜¾ç¤º/éšè—æƒé‡è®¾ç½®
            weightSection.classList.toggle('show', method === 'comprehensive' || method === 'all');
        }

        function updateWeights() {
            const profitWeight = parseInt(document.getElementById('profitWeight').value);
            const salesWeight = parseInt(document.getElementById('salesWeight').value);

            document.getElementById('profitWeightValue').textContent = profitWeight;
            document.getElementById('salesWeightValue').textContent = salesWeight;
        }

        function startAnalysis() {
            showLoading(true);

            setTimeout(() => {
                try {
                    const profitWeight = parseInt(document.getElementById('profitWeight').value) / 100;
                    const salesWeight = parseInt(document.getElementById('salesWeight').value) / 100;

                    analysisResults = {
                        products: rawData,
                        method: selectedMethod,
                        weights: { profit: profitWeight, sales: salesWeight }
                    };

                    // æ‰§è¡Œå„ç§åˆ†æ
                    analysisResults.statistics = calculateStatistics(rawData);
                    analysisResults.normalized = normalizeData(rawData);
                    analysisResults.scores = calculateScores(analysisResults.normalized, profitWeight, salesWeight);
                    analysisResults.grades = assignGrades(analysisResults.scores);
                    analysisResults.abc = performABCAnalysis(rawData);
                    analysisResults.clusters = performClustering(rawData);

                    displayResults();
                    showLoading(false);
                    resultsSection.classList.add('show');
                    resultsSection.scrollIntoView({ behavior: 'smooth' });

                } catch (error) {
                    showLoading(false);
                    showError('åˆ†æè¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ï¼š' + error.message);
                    console.error('Error:', error);
                }
            }, 500);
        }

        function calculateStatistics(products) {
            const sales = products.map(p => p.sales);
            const profit = products.map(p => p.profit);

            return {
                count: products.length,
                totalSales: sales.reduce((a, b) => a + b, 0),
                totalProfit: profit.reduce((a, b) => a + b, 0),
                avgSales: sales.reduce((a, b) => a + b, 0) / sales.length,
                avgProfit: profit.reduce((a, b) => a + b, 0) / profit.length,
                maxSales: Math.max(...sales),
                minSales: Math.min(...sales),
                maxProfit: Math.max(...profit),
                minProfit: Math.min(...profit),
                salesMedian: sales.sort((a, b) => a - b)[Math.floor(sales.length / 2)],
                profitMedian: profit.sort((a, b) => a - b)[Math.floor(profit.length / 2)]
            };
        }

        function normalizeData(products) {
            const sales = products.map(p => p.sales);
            const profit = products.map(p => p.profit);

            const minSales = Math.min(...sales);
            const maxSales = Math.max(...sales);
            const minProfit = Math.min(...profit);
            const maxProfit = Math.max(...profit);

            return products.map(p => ({
                ...p,
                normalizedSales: maxSales > minSales ? (p.sales - minSales) / (maxSales - minSales) : 0.5,
                normalizedProfit: maxProfit > minProfit ? (p.profit - minProfit) / (maxProfit - minProfit) : 0.5
            }));
        }

        function calculateScores(normalized, profitWeight, salesWeight) {
            return normalized.map(p => ({
                ...p,
                score: p.normalizedProfit * profitWeight + p.normalizedSales * salesWeight,
                profitScore: p.normalizedProfit * 100,
                salesScore: p.normalizedSales * 100
            })).sort((a, b) => b.score - a.score);
        }

        function assignGrades(scores) {
            const threshold = {
                S: 0.9,
                A: 0.75,
                B: 0.6,
                C: 0.4
            };

            return scores.map(p => {
                let grade;
                if (p.score >= threshold.S) grade = 'S';
                else if (p.score >= threshold.A) grade = 'A';
                else if (p.score >= threshold.B) grade = 'B';
                else if (p.score >= threshold.C) grade = 'C';
                else grade = 'D';
                return { ...p, grade };
            });
        }

        function performABCAnalysis(products) {
            // æŒ‰æ¯›åˆ©ABCåˆ†ç±»
            const sortedByProfit = [...products].sort((a, b) => b.profit - a.profit);
            const totalProfit = sortedByProfit.reduce((sum, p) => sum + p.profit, 0);
            let accumulatedProfit = 0;

            const profitABC = sortedByProfit.map(p => {
                accumulatedProfit += p.profit;
                const percentage = accumulatedProfit / totalProfit;
                let abc;
                if (percentage <= 0.7) abc = 'A';
                else if (percentage <= 0.9) abc = 'B';
                else abc = 'C';
                return { ...p, profitABC: abc };
            });

            // æŒ‰é”€é‡ABCåˆ†ç±»
            const sortedBySales = [...products].sort((a, b) => b.sales - a.sales);
            const totalSales = sortedBySales.reduce((sum, p) => sum + p.sales, 0);
            let accumulatedSales = 0;

            const salesABC = sortedBySales.map(p => {
                accumulatedSales += p.sales;
                const percentage = accumulatedSales / totalSales;
                let abc;
                if (percentage <= 0.7) abc = 'A';
                else if (percentage <= 0.9) abc = 'B';
                else abc = 'C';
                return { ...p, salesABC: abc };
            });

            // åˆå¹¶åˆ†ç±»ç»“æœ
            const profitMap = new Map(profitABC.map(p => [p.name, p.profitABC]));
            const salesMap = new Map(salesABC.map(p => [p.name, p.salesABC]));

            return products.map(p => ({
                ...p,
                profitABC: profitMap.get(p.name) || 'C',
                salesABC: salesMap.get(p.name) || 'C'
            }));
        }

        function performClustering(products) {
            // ç®€å•K-meanså®ç°ï¼Œk=4
            const normalized = analysisResults.normalized;
            const k = 4;

            // åˆå§‹åŒ–èšç±»ä¸­å¿ƒ
            let centers = [];
            for (let i = 0; i < k; i++) {
                centers.push({
                    x: Math.random(),
                    y: Math.random()
                });
            }

            // è¿­ä»£ä¼˜åŒ–
            for (let iter = 0; iter < 100; iter++) {
                // åˆ†é…èšç±»
                const clusters = Array(k).fill(null).map(() => []);
                normalized.forEach(p => {
                    let minDist = Infinity;
                    let clusterIdx = 0;
                    centers.forEach((center, idx) => {
                        const dist = Math.sqrt(
                            Math.pow(p.normalizedSales - center.x, 2) +
                            Math.pow(p.normalizedProfit - center.y, 2)
                        );
                        if (dist < minDist) {
                            minDist = dist;
                            clusterIdx = idx;
                        }
                    });
                    clusters[clusterIdx].push(p);
                });

                // æ›´æ–°ä¸­å¿ƒ
                let changed = false;
                clusters.forEach((cluster, idx) => {
                    if (cluster.length > 0) {
                        const newCenter = {
                            x: cluster.reduce((sum, p) => sum + p.normalizedSales, 0) / cluster.length,
                            y: cluster.reduce((sum, p) => sum + p.normalizedProfit, 0) / cluster.length
                        };
                        if (Math.abs(newCenter.x - centers[idx].x) > 0.001 || 
                            Math.abs(newCenter.y - centers[idx].y) > 0.001) {
                            changed = true;
                        }
                        centers[idx] = newCenter;
                    }
                });

                if (!changed) break;
            }

            // æœ€ç»ˆåˆ†é…
            const clusters = Array(k).fill(null).map(() => []);
            normalized.forEach((p, idx) => {
                let minDist = Infinity;
                let clusterIdx = 0;
                centers.forEach((center, idx) => {
                    const dist = Math.sqrt(
                        Math.pow(p.normalizedSales - center.x, 2) +
                        Math.pow(p.normalizedProfit - center.y, 2)
                    );
                    if (dist < minDist) {
                        minDist = dist;
                        clusterIdx = idx;
                    }
                });
                p.cluster = clusterIdx + 1;
                clusters[clusterIdx].push(p);
            });

            // ä¸ºæ¯ä¸ªç°‡å‘½å
            const clusterNames = ['æ ¸å¿ƒå•†å“', 'æ½œåŠ›å•†å“', 'æµé‡å•†å“', 'é—®é¢˜å•†å“'];
            const avgProfit = clusters.map(c => c.reduce((sum, p) => sum + p.normalizedProfit, 0) / (c.length || 1));
            const avgSales = clusters.map(c => c.reduce((sum, p) => sum + p.normalizedSales, 0) / (c.length || 1));

            const sortedIndices = avgProfit.map((v, i) => [v, avgSales[i], i])
                .sort((a, b) => b[0] + b[1] - (a[0] + a[1]))
                .map(([v1, v2, idx]) => idx);

            return normalized.map(p => ({
                ...p,
                cluster: p.cluster,
                clusterName: clusterNames[sortedIndices.indexOf(p.cluster - 1)]
            }));
        }

        function displayResults() {
            displayStatistics();
            displayScoreRanking();
            displayABCAnalysis();
            displayClusterResults();
            displayCharts();
            displayFullTable();
            setupRadarChartEvents();
        }

        function displayStatistics() {
            const stats = analysisResults.statistics;
            document.getElementById('statsGrid').innerHTML = `
                <div class="stat-item">
                    <div class="stat-value">${stats.count}</div>
                    <div class="stat-label">å•†å“æ€»æ•°</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">${stats.totalSales.toLocaleString()}</div>
                    <div class="stat-label">æ€»é”€é‡</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">Â¥${stats.totalProfit.toLocaleString(undefined, {maximumFractionDigits: 2})}</div>
                    <div class="stat-label">æ€»æ¯›åˆ©é¢</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">${stats.avgSales.toFixed(1)}</div>
                    <div class="stat-label">å¹³å‡é”€é‡</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">Â¥${stats.avgProfit.toFixed(2)}</div>
                    <div class="stat-label">å¹³å‡æ¯›åˆ©</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">${stats.salesMedian.toFixed(0)}</div>
                    <div class="stat-label">é”€é‡ä¸­ä½æ•°</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">Â¥${stats.profitMedian.toFixed(2)}</div>
                    <div class="stat-label">æ¯›åˆ©ä¸­ä½æ•°</div>
                </div>
            `;
        }

        function displayScoreRanking() {
            const scores = analysisResults.grades.slice(0, 50);

            document.getElementById('scoreRanking').innerHTML = scores.map((p, i) => {
                const rankClass = i < 3 ? `rank-${i + 1}` : 'rank-other';
                const gradeClass = `grade-${p.grade.toLowerCase()}`;

                return `
                    <div class="score-item">
                        <div class="rank-badge ${rankClass}">${i + 1}</div>
                        <div class="product-info">
                            <div class="product-name">${p.name}</div>
                            <div class="product-spec">${p.spec || '-'}</div>
                        </div>
                        <div class="score-value">${(p.score * 100).toFixed(1)}</div>
                        <div class="score-breakdown">
                            <span class="breakdown-item">æ¯›:${p.profitScore.toFixed(0)}</span>
                            <span class="breakdown-item">é”€:${p.salesScore.toFixed(0)}</span>
                        </div>
                        <div class="grade-badge ${gradeClass}">${p.grade}çº§</div>
                    </div>
                `;
            }).join('');
        }

        function displayABCAnalysis() {
            const abcData = analysisResults.abc;

            // æŒ‰ABCåˆ†ç±»åˆ†ç»„
            const profitGroups = { A: [], B: [], C: [] };
            const salesGroups = { A: [], B: [], C: [] };

            abcData.forEach(p => {
                profitGroups[p.profitABC].push(p);
                salesGroups[p.salesABC].push(p);
            });

            // ABCåˆ†ç±»åˆ—è¡¨
            document.getElementById('abcGrid').innerHTML = `
                <div class="abc-category abc-a">
                    <div class="abc-header">Aç±»ï¼ˆæ¯›åˆ©Top30%ï¼‰</div>
                    <div class="abc-body">
                        ${profitGroups.A.slice(0, 20).map(p => `
                            <div class="abc-product">
                                <div class="abc-product-name">${p.name}</div>
                                <div class="abc-product-stats">æ¯›åˆ©:Â¥${p.profit.toFixed(2)} | é”€é‡:${Math.round(p.sales)}</div>
                            </div>
                        `).join('')}
                        ${profitGroups.A.length > 20 ? `<p style="color:#999;text-align:center;">...è¿˜æœ‰${profitGroups.A.length - 20}ä¸ª</p>` : ''}
                    </div>
                </div>
                <div class="abc-category abc-b">
                    <div class="abc-header">Bç±»ï¼ˆæ¯›åˆ©30%-90%ï¼‰</div>
                    <div class="abc-body">
                        ${profitGroups.B.slice(0, 20).map(p => `
                            <div class="abc-product">
                                <div class="abc-product-name">${p.name}</div>
                                <div class="abc-product-stats">æ¯›åˆ©:Â¥${p.profit.toFixed(2)} | é”€é‡:${Math.round(p.sales)}</div>
                            </div>
                        `).join('')}
                        ${profitGroups.B.length > 20 ? `<p style="color:#999;text-align:center;">...è¿˜æœ‰${profitGroups.B.length - 20}ä¸ª</p>` : ''}
                    </div>
                </div>
                <div class="abc-category abc-c">
                    <div class="abc-header">Cç±»ï¼ˆæ¯›åˆ©Bottom10%ï¼‰</div>
                    <div class="abc-body">
                        ${profitGroups.C.slice(0, 20).map(p => `
                            <div class="abc-product">
                                <div class="abc-product-name">${p.name}</div>
                                <div class="abc-product-stats">æ¯›åˆ©:Â¥${p.profit.toFixed(2)} | é”€é‡:${Math.round(p.sales)}</div>
                            </div>
                        `).join('')}
                        ${profitGroups.C.length > 20 ? `<p style="color:#999;text-align:center;">...è¿˜æœ‰${profitGroups.C.length - 20}ä¸ª</p>` : ''}
                    </div>
                </div>
            `;

            // äº¤å‰åˆ†æçŸ©é˜µ
            const crossData = {};
            abcData.forEach(p => {
                const key = `${p.profitABC}${p.salesABC}`;
                if (!crossData[key]) crossData[key] = [];
                crossData[key].push(p);
            });

            document.getElementById('crossAnalysis').innerHTML = `
                <table class="cross-table">
                    <tr>
                        <th></th>
                        <th>é”€é‡Aç±»</th>
                        <th>é”€é‡Bç±»</th>
                        <th>é”€é‡Cç±»</th>
                    </tr>
                    <tr>
                        <th>æ¯›åˆ©Aç±»</th>
                        <td class="cross-category cross-aa">${(crossData['AA'] || []).length}ä¸ª</td>
                        <td class="cross-category cross-ab">${(crossData['AB'] || []).length}ä¸ª</td>
                        <td class="cross-category cross-ac">${(crossData['AC'] || []).length}ä¸ª</td>
                    </tr>
                    <tr>
                        <th>æ¯›åˆ©Bç±»</th>
                        <td class="cross-category cross-ba">${(crossData['BA'] || []).length}ä¸ª</td>
                        <td class="cross-category cross-bb">${(crossData['BB'] || []).length}ä¸ª</td>
                        <td class="cross-category cross-bc">${(crossData['BC'] || []).length}ä¸ª</td>
                    </tr>
                    <tr>
                        <th>æ¯›åˆ©Cç±»</th>
                        <td class="cross-category cross-ca">${(crossData['CA'] || []).length}ä¸ª</td>
                        <td class="cross-category cross-cb">${(crossData['CB'] || []).length}ä¸ª</td>
                        <td class="cross-category cross-cc">${(crossData['CC'] || []).length}ä¸ª</td>
                    </tr>
                </table>
            `;
        }

        function displayClusterResults() {
            const clusters = analysisResults.clusters;
            const clusterStats = {};

            clusters.forEach(p => {
                if (!clusterStats[p.cluster]) {
                    clusterStats[p.cluster] = {
                        name: p.clusterName,
                        count: 0,
                        totalProfit: 0,
                        totalSales: 0
                    };
                }
                clusterStats[p.cluster].count++;
                clusterStats[p.cluster].totalProfit += p.profit;
                clusterStats[p.cluster].totalSales += p.sales;
            });

            document.getElementById('clusterStats').innerHTML = Object.values(clusterStats).map(c => `
                <div style="padding:15px;background:#f8f9fa;border-radius:10px;margin-bottom:10px;">
                    <div style="font-weight:bold;color:#333;margin-bottom:5px;">${c.name}ï¼ˆ${c.count}ä¸ªå•†å“ï¼‰</div>
                    <div style="font-size:0.9em;color:#666;">
                        å¹³å‡æ¯›åˆ©:Â¥${(c.totalProfit / c.count).toFixed(2)} | å¹³å‡é”€é‡:${(c.totalSales / c.count).toFixed(0)}
                    </div>
                </div>
            `).join('');
        }

        function displayCharts() {
            displayClusterChart();
            displayQuadrantChart();
            displayHistogramChart();
            displayScatterChart();
            displayRadarChart();
        }

        function displayClusterChart() {
            const ctx = document.getElementById('clusterChart').getContext('2d');
            if (chartInstances.cluster) chartInstances.cluster.destroy();

            const colors = ['#27ae60', '#3498db', '#f39c12', '#e74c3c'];
            const clusters = analysisResults.clusters;

            const datasets = [1, 2, 3, 4].map(clusterNum => ({
                label: `${clusterNum}ç°‡`,
                data: clusters.filter(p => p.cluster === clusterNum).map(p => ({
                    x: p.normalizedSales * 100,
                    y: p.normalizedProfit * 100
                })),
                backgroundColor: colors[clusterNum - 1] + '80',
                borderColor: colors[clusterNum - 1],
                borderWidth: 1,
                pointRadius: 5
            }));

            chartInstances.cluster = new Chart(ctx, {
                type: 'scatter',
                data: { datasets },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { position: 'top' } },
                    scales: {
                        x: { title: { display: true, text: 'é”€é‡(æ ‡å‡†åŒ–)' }, min: 0, max: 100 },
                        y: { title: { display: true, text: 'æ¯›åˆ©(æ ‡å‡†åŒ–)' }, min: 0, max: 100 }
                    }
                }
            });
        }

        function displayQuadrantChart() {
            const ctx = document.getElementById('quadrantChart').getContext('2d');
            if (chartInstances.quadrant) chartInstances.quadrant.destroy();

            const scores = analysisResults.grades;
            const medianSales = analysisResults.statistics.salesMedian;
            const medianProfit = analysisResults.statistics.profitMedian;

            const datasets = [
                { label: 'é«˜æ¯›é«˜é”€', data: scores.filter(p => p.profit >= medianProfit && p.sales >= medianSales), color: '#27ae60' },
                { label: 'é«˜æ¯›ä½é”€', data: scores.filter(p => p.profit >= medianProfit && p.sales < medianSales), color: '#3498db' },
                { label: 'ä½æ¯›é«˜é”€', data: scores.filter(p => p.profit < medianProfit && p.sales >= medianSales), color: '#f39c12' },
                { label: 'ä½æ¯›ä½é”€', data: scores.filter(p => p.profit < medianProfit && p.sales < medianSales), color: '#e74c3c' }
            ];

            chartInstances.quadrant = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: datasets.map(d => ({
                        label: d.label,
                        data: d.data.map(p => ({ x: p.sales, y: p.profit })),
                        backgroundColor: d.color + '80',
                        borderColor: d.color,
                        borderWidth: 1,
                        pointRadius: 4
                    }))
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { position: 'top' } },
                    scales: {
                        x: { title: { display: true, text: 'é”€é‡' } },
                        y: { title: { display: true, text: 'æ¯›åˆ©é¢(å…ƒ)' } }
                    }
                }
            });
        }

        function displayHistogramChart() {
            const ctx = document.getElementById('histogramChart').getContext('2d');
            if (chartInstances.histogram) chartInstances.histogram.destroy();

            const scores = analysisResults.grades.map(p => p.score * 100);
            const bins = 20;
            const binWidth = 100 / bins;
            const histogram = new Array(bins).fill(0);

            scores.forEach(s => {
                const binIndex = Math.min(Math.floor(s / binWidth), bins - 1);
                histogram[binIndex]++;
            });

            chartInstances.histogram = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: histogram.map((_, i) => `${Math.round(i * binWidth)}-${Math.round((i + 1) * binWidth)}`),
                    datasets: [{
                        label: 'å•†å“æ•°é‡',
                        data: histogram,
                        backgroundColor: 'rgba(102, 126, 234, 0.6)',
                        borderColor: 'rgba(102, 126, 234, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        x: { title: { display: true, text: 'ç»¼åˆå¾—åˆ†åŒºé—´' } },
                        y: { title: { display: true, text: 'å•†å“æ•°é‡' } }
                    }
                }
            });
        }

        function displayScatterChart() {
            const ctx = document.getElementById('scatterChart').getContext('2d');
            if (chartInstances.scatter) chartInstances.scatter.destroy();

            const grades = analysisResults.grades;
            const colors = { S: '#ffd700', A: '#27ae60', B: '#3498db', C: '#f39c12', D: '#e74c3c' };

            chartInstances.scatter = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: ['S', 'A', 'B', 'C', 'D'].map(grade => ({
                        label: `${grade}çº§`,
                        data: grades.filter(p => p.grade === grade).map(p => ({ x: p.sales, y: p.profit })),
                        backgroundColor: colors[grade] + '80',
                        borderColor: colors[grade],
                        borderWidth: 1,
                        pointRadius: 5
                    }))
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { position: 'top' } },
                    scales: {
                        x: { title: { display: true, text: 'é”€é‡' } },
                        y: { title: { display: true, text: 'æ¯›åˆ©é¢(å…ƒ)' } }
                    }
                }
            });
        }

        // å¤šç»´åº¦é›·è¾¾å›¾åˆ†æ
        function displayRadarChart() {
            const ctx = document.getElementById('radarChart').getContext('2d');
            if (chartInstances.radar) chartInstances.radar.destroy();

            const viewMode = document.getElementById('radarViewMode').value;
            const stats = analysisResults.statistics;
            const grades = analysisResults.grades;

            let datasets = [];
            const colors = {
                'S': { bg: 'rgba(255, 215, 0, 0.3)', border: '#ffd700' },
                'A': { bg: 'rgba(39, 174, 96, 0.3)', border: '#27ae60' },
                'B': { bg: 'rgba(52, 152, 219, 0.3)', border: '#3498db' },
                'C': { bg: 'rgba(243, 156, 18, 0.3)', border: '#f39c12' },
                'D': { bg: 'rgba(231, 76, 60, 0.3)', border: '#e74c3c' }
            };

            if (viewMode === 'top10') {
                // TOP10å•†å“å¯¹æ¯”
                const top10 = grades.slice(0, 10);
                datasets = top10.map((p, idx) => {
                    const metrics = calculateProductMetrics(p, stats);
                    return {
                        label: `${idx + 1}. ${p.name.substring(0, 10)}`,
                        data: [
                            metrics.profitability,
                            metrics.salesHeat,
                            metrics.comprehensive,
                            metrics.profitShare,
                            metrics.salesShare,
                            metrics.valueCoeff
                        ],
                        backgroundColor: `hsla(${220 + idx * 20}, 70%, 50%, 0.2)`,
                        borderColor: `hsla(${220 + idx * 20}, 70%, 50%, 0.8)`,
                        borderWidth: 2,
                        pointRadius: 4
                    };
                });
            } else if (viewMode === 'grade') {
                // å„ç­‰çº§å¹³å‡è¡¨ç°
                const gradeOrder = ['S', 'A', 'B', 'C', 'D'];
                datasets = gradeOrder.map(grade => {
                    const gradeProducts = grades.filter(p => p.grade === grade);
                    if (gradeProducts.length === 0) return null;

                    const avgMetrics = {
                        profitability: 0,
                        salesHeat: 0,
                        comprehensive: 0,
                        profitShare: 0,
                        salesShare: 0,
                        valueCoeff: 0
                    };

                    gradeProducts.forEach(p => {
                        const m = calculateProductMetrics(p, stats);
                        avgMetrics.profitability += m.profitability;
                        avgMetrics.salesHeat += m.salesHeat;
                        avgMetrics.comprehensive += m.comprehensive;
                        avgMetrics.profitShare += m.profitShare;
                        avgMetrics.salesShare += m.salesShare;
                        avgMetrics.valueCoeff += m.valueCoeff;
                    });

                    const count = gradeProducts.length;
                    return {
                        label: `${grade}çº§ (${count}ä¸ª)`,
                        data: [
                            avgMetrics.profitability / count,
                            avgMetrics.salesHeat / count,
                            avgMetrics.comprehensive / count,
                            avgMetrics.profitShare / count,
                            avgMetrics.salesShare / count,
                            avgMetrics.valueCoeff / count
                        ],
                        backgroundColor: colors[grade].bg,
                        borderColor: colors[grade].border,
                        borderWidth: 2,
                        pointRadius: 5
                    };
                }).filter(d => d !== null);
            } else if (viewMode === 'custom') {
                const select = document.getElementById('radarProductSelect');
                const selectedName = select.value;
                if (!selectedName) {
                    datasets = [{
                        label: 'è¯·é€‰æ‹©å•†å“',
                        data: [0, 0, 0, 0, 0, 0],
                        backgroundColor: 'rgba(200, 200, 200, 0.2)',
                        borderColor: 'rgba(200, 200, 200, 0.8)',
                        borderWidth: 1
                    }];
                } else {
                    const p = grades.find(g => g.name === selectedName);
                    if (p) {
                        const metrics = calculateProductMetrics(p, stats);
                        datasets = [{
                            label: p.name,
                            data: [
                                metrics.profitability,
                                metrics.salesHeat,
                                metrics.comprehensive,
                                metrics.profitShare,
                                metrics.salesShare,
                                metrics.valueCoeff
                            ],
                            backgroundColor: 'rgba(102, 126, 234, 0.3)',
                            borderColor: '#667eea',
                            borderWidth: 2,
                            pointRadius: 5
                        }];
                    }
                }
            }

            chartInstances.radar = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['ç›ˆåˆ©èƒ½åŠ›', 'é”€å”®çƒ­åº¦', 'ç»¼åˆè¯„åˆ†', 'åˆ©æ¶¦å æ¯”', 'é”€é‡å æ¯”', 'ä»·å€¼ç³»æ•°'],
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                boxWidth: 12,
                                font: { size: 11 }
                            }
                        }
                    },
                    scales: {
                        r: {
                            min: 0,
                            max: 100,
                            ticks: {
                                stepSize: 20,
                                font: { size: 10 }
                            },
                            pointLabels: {
                                font: { size: 12, weight: 'bold' }
                            },
                            grid: {
                                color: 'rgba(200, 200, 200, 0.3)'
                            }
                        }
                    }
                }
            });
        }

        function calculateProductMetrics(product, stats) {
            // æ ‡å‡†åŒ–æ¯›åˆ©å¾—åˆ† (0-100)
            const profitScore = product.profitScore;

            // æ ‡å‡†åŒ–é”€é‡å¾—åˆ† (0-100)
            const salesScore = product.salesScore;

            // ç»¼åˆè¯„åˆ† (0-100)
            const comprehensive = product.score * 100;

            // åˆ©æ¶¦å æ¯” (0-100ï¼ŒåŸºäºç›¸å¯¹æ¯”ä¾‹)
            const profitShare = Math.min((product.profit / stats.totalProfit) * 100 * 10, 100);

            // é”€é‡å æ¯” (0-100ï¼ŒåŸºäºç›¸å¯¹æ¯”ä¾‹)
            const salesShare = Math.min((product.sales / stats.totalSales) * 100 * 10, 100);

            // ä»·å€¼ç³»æ•° (æ¯›åˆ©/é”€é‡ï¼Œæ ‡å‡†åŒ–åˆ°0-100)
            const avgProfitPerSale = product.sales > 0 ? product.profit / product.sales : 0;
            const overallAvgProfitPerSale = stats.totalProfit / stats.totalSales;
            const valueCoeff = overallAvgProfitPerSale > 0
                ? Math.min((avgProfitPerSale / overallAvgProfitPerSale) * 50, 100)
                : 50;

            return {
                profitability: profitScore,
                salesHeat: salesScore,
                comprehensive: comprehensive,
                profitShare: profitShare,
                salesShare: salesShare,
                valueCoeff: valueCoeff
            };
        }

        function setupRadarChartEvents() {
            const viewMode = document.getElementById('radarViewMode');
            const productSelect = document.getElementById('radarProductSelect');

            viewMode.addEventListener('change', function() {
                if (this.value === 'custom') {
                    // å¡«å……å•†å“é€‰æ‹©ä¸‹æ‹‰æ¡†
                    const grades = analysisResults.grades;
                    productSelect.innerHTML = '<option value="">è¯·é€‰æ‹©å•†å“</option>' +
                        grades.map(p => `<option value="${p.name}">${p.name}</option>`).join('');
                    productSelect.style.display = 'inline-block';
                } else {
                    productSelect.style.display = 'none';
                }
                displayRadarChart();
            });

            productSelect.addEventListener('change', function() {
                displayRadarChart();
            });
        }

        function displayFullTable() {
            const grades = analysisResults.grades;
            const abc = analysisResults.abc;
            const clusters = analysisResults.clusters;

            const abcMap = new Map(abc.map(p => [p.name, `${p.profitABC}/${p.salesABC}`]));
            const clusterMap = new Map(clusters.map(p => [p.name, p.clusterName]));

            document.getElementById('fullDataBody').innerHTML = grades.map((p, i) => `
                <tr>
                    <td>${i + 1}</td>
                    <td>${p.name}</td>
                    <td>${p.spec || '-'}</td>
                    <td>${Math.round(p.sales)}</td>
                    <td>${p.profit.toFixed(2)}</td>
                    <td>${(p.score * 100).toFixed(1)}</td>
                    <td><span class="grade-badge grade-${p.grade.toLowerCase()}">${p.grade}çº§</span></td>
                    <td>${abcMap.get(p.name) || '-'}</td>
                    <td>${clusterMap.get(p.name) || '-'}</td>
                </tr>
            `).join('');
        }

        function downloadReport() {
            const grades = analysisResults.grades;
            const abc = analysisResults.abc;
            const clusters = analysisResults.clusters;

            let csv = 'æ’å,å•†å“åç§°,è§„æ ¼,SKU,é”€é‡,æ¯›åˆ©é¢,ç»¼åˆå¾—åˆ†,ç­‰çº§,ABCåˆ†ç±»(æ¯›/é”€),èšç±»ç°‡\n';

            grades.forEach((p, i) => {
                const abcKey = abc.find(a => a.name === p.name);
                const clusterKey = clusters.find(c => c.name === p.name);
                csv += `${i + 1},"${p.name}","${p.spec}","${p.sku}",${p.sales},${p.profit.toFixed(2)},${(p.score * 100).toFixed(1)},${p.grade},${abcKey ? abcKey.profitABC + '/' + abcKey.salesABC : '-'},${clusterKey ? clusterKey.clusterName : '-'}\n`;
            });

            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'å•†å“ç»¼åˆåˆ†ææŠ¥å‘Š.csv';
            link.click();
            URL.revokeObjectURL(link.href);
        }

        function showLoading(show) {
            loading.classList.toggle('show', show);
        }

        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.classList.add('show');
        }

        function hideError() {
            errorMessage.classList.remove('show');
        }

        function handleScroll() {
            document.getElementById('backToTop').classList.toggle('show', window.scrollY > 300);
        }

        function scrollToTop() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function reset() {
            methodSection.style.display = 'none';
            resultsSection.classList.remove('show');
            rawData = null;
            analysisResults = null;
            fileInput.value = '';
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
    </script>
</body>
</html>
